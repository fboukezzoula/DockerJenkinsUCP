Si vous avez pu résoudre le problème en ajoutant l'option --network=true lors de la création du conteneur avec Podman, cela indique que SELinux restreint l'accès réseau des conteneurs au système hôte par défaut.

Pour permettre aux conteneurs Podman de communiquer avec le réseau de l'hôte en utilisant SELinux, vous pouvez ajouter une règle personnalisée. Voici comment vous pouvez créer une règle personnalisée pour autoriser la communication réseau des conteneurs :

Identifiez le port que vous souhaitez autoriser pour la communication du conteneur. Par exemple, si votre proxy utilise le port 3128, vous pouvez autoriser ce port.

Utilisez la commande audit2allow pour générer une règle SELinux personnalisée basée sur les journaux de SELinux. Exécutez la commande suivante après avoir effectué une opération de conteneur qui a été refusée par SELinux (par exemple, après avoir exécuté le conteneur avec l'option --network=true) :

bash
Copy code
audit2allow -a
Cela affichera les règles qui ont été refusées. Vous pouvez les copier dans un fichier.

Créez un fichier de règles personnalisées, par exemple custom-containers.te, et collez-y les règles générées.

Utilisez checkmodule pour compiler les règles :

bash
Copy code
checkmodule -M -m -o custom-containers.mod custom-containers.te
Utilisez semodule_package pour générer un module SELinux :

bash
Copy code
semodule_package -o custom-containers.pp -m custom-containers.mod
Utilisez semodule pour installer le module SELinux :

bash
Copy code
semodule -i custom-containers.pp
Redémarrez le conteneur pour que les nouvelles règles SELinux prennent effet.

Cela devrait autoriser la communication réseau du conteneur avec le port spécifié. Assurez-vous de personnaliser les règles en fonction de vos besoins spécifiques.

N'oubliez pas que l'ajout de règles SELinux personnalisées peut potentiellement introduire des vulnérabilités de sécurité si elles sont mal configurées, alors assurez-vous de comprendre les implications de sécurité avant d'appliquer des règles personnalisées.





Il semble que vous ayez des problèmes pour faire fonctionner Podman avec un proxy sous RHEL 8 pour la construction d'images, malgré la définition des variables d'environnement http_proxy, https_proxy, no_proxy, etc. pour votre proxy. Voici quelques étapes que vous pouvez suivre pour résoudre ce problème :

Assurez-vous que Podman est configuré pour utiliser le proxy du système :
Vous pouvez vérifier la configuration de Podman en utilisant la commande suivante :

bash
Copy code
podman system info
Assurez-vous que l'option "HTTP Proxy" pointe vers votre proxy local ou vers l'adresse appropriée. Si ce n'est pas le cas, vous pouvez configurer Podman pour utiliser le proxy du système en ajoutant la ligne suivante dans le fichier de configuration de Podman, généralement situé à /etc/containers/containers.conf :

ini
Copy code
[proxies]
"default" = "system"
Cela devrait permettre à Podman d'utiliser le proxy du système défini dans les variables d'environnement.

Redémarrez le service Podman :
Après avoir modifié la configuration de Podman, redémarrez le service Podman pour que les modifications prennent effet :

bash
Copy code
systemctl restart podman
Assurez-vous que les variables d'environnement du proxy sont correctement définies :
Comme vous l'avez mentionné, assurez-vous que les variables d'environnement http_proxy, https_proxy, no_proxy, etc. sont correctement définies avec les valeurs appropriées. Vous pouvez les vérifier en utilisant la commande echo :

bash
Copy code
echo $http_proxy
echo $https_proxy
echo $no_proxy
Testez la connectivité au proxy :
Assurez-vous que votre système est capable de se connecter au proxy en utilisant les variables d'environnement définies. Vous pouvez utiliser la commande curl pour effectuer un test de connexion :

bash
Copy code
curl http://example.com --proxy $http_proxy
Assurez-vous que les fichiers PAC sont correctement configurés :
Vérifiez que les fichiers de configuration Proxy Auto-Configuration (PAC) sont correctement configurés sur votre système et qu'ils sont accessibles. Podman utilisera ces fichiers s'ils sont correctement configurés.

Si, après avoir suivi ces étapes, vous rencontrez toujours des problèmes pour construire des images avec Podman via le proxy, vous pouvez également consulter les journaux de Podman (journalctl -u podman.service) pour des informations plus détaillées sur les erreurs rencontrées.

Enfin, assurez-vous que vous avez les droits d'accès appropriés pour utiliser le proxy, car certaines politiques d'entreprise peuvent restreindre l'accès aux proxies. Si vous rencontrez des problèmes persistants, il peut être utile de travailler en étroite collaboration avec le service informatique de votre entreprise pour résoudre ces problèmes.
